******************************************************************************
    MICRO C CUBE / STANDARD, NETWORK SAMPLE
    Atmark Techno Armadillo-440(A4400-D00Z) 向けサンプルプログラム
    Copyright (c)  2013-2015, eForce Co., Ltd. All rights reserved.
******************************************************************************

・本ファイルは、サンプルプログラムの概要、及び専用デバイスドライバを含む場合は
  その概要、そのほか、更新履歴などの情報を記述しています。


━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
１．開発環境
───────────────────────────────────────
　本サンプルプログラムは下記の評価ボードと開発ツールを使用しています。

  評価ボード       : Armadillo-440 (A4400-D00Z)
  コンパイラ       : IAR Embedded Workbench 7.10.3
  JTAGエミュレータ : J-Link


━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
２．サンプルプログラム動作概要
───────────────────────────────────────
サンプルプログラムでは次のネットワークアプリが動作します。

    DHCPクライアント
    HTTPサーバー
    FTPサーバー
    PINGクライアント
    DNSクライアント

   ■ターミナルエミュレーターからの操作(UART2)
   
    　プログラムが実行されるとターミナルエミュレータに次のように文字列が
    表示されます。

                eForce Operating System Sample Program V1.0
                        Serial Port (UART2)
        
        DHCP: Success
        uC3 Shell 1.0
        Shell>
    

    　ターミナルでは次のコマンドが使用できます。
    
        ip    : IPアドレスの確認
        ipcfg : IPアドレスの設定
        dns   : DNSで名前解決
        ping  : PINGをICMPで送信
        ping6 : PINGをICMPv6で送信(IPv6パッケージのみ) 
        ?     : ヘルプを表示
        
    　使用例は次のようになります。
    
        Shell>ip
         devID=1:
          IPv4 Address  : 192.168.1.103
          Subnet Mask   : 255.255.255.0
          Gateway       : 192.168.1.1

        Shell>ipcfg
         Enter new values..
         IP Address  : 192.168.1.102
         Subnet Mask : 255.255.255.0
         Gateway     : 192.168.1.1
        
        Shell>dns www.eforce.co.jp
        xxx.xxx.xxx.xxx
        
        Shell>ping 192.168.1.1
         ping request successful

   ■HTTPサーバー
   　評価ボードではHTTPサーバーが動作しています。ウェブブラウザで評価ボードの
   IPアドレスのページを開くことができます。また、HTTPサーバーではCGIが使用でき
   ます。ウェブブラウザでcgi_valに値を入力して"Set"のボタンを押すとターミナルに
   　次の例のように文字列が表示されます。
    
        CGI: cgi_val set to 123
        
   ■FTPサーバー
   　PCなどのFTPクライアントからlogin,put,get,quitコマンドが実行できます。
   　WindowsのFTPコマンドを使用しsrc.txtというファイルをターゲットボードに
   送信し、dst.txtというファイルで受信するには以下の様にして下さい。
         
           例）ftp>open 192.168.11.30
                     :
             <ユーザ/パスワードなし>
                     :
             ftp>put src.txt
             ftp>get src.txt dst.txt
             ftp>quit
         
         FTPサーバーが受信できるファイルサイズの上限は1Kバイトです。        
        
   ■DHCPクライアント
     本サンプルプログラムはDHCPサーバーからIPアドレスを取得します。
     DHCPサーバーが無い環境で動作させる場合はnet.c/net_cfg.cの次の項目を
   変更してください。
   　
   　◆ net.c
   　　#define DHCP_ENB      0  /* DHCPを無効 */
   
   　◆ net_cfg.c
   　　
      /* IPアドレスの設定 */
      T_NET_ADR gNET_ADR[] = {
          {0x0, 0x0, 0xC0A8000B,  0xC0A80001, 0xFFFFFF00}
          /* 0,   0, IP Address,  Gateway,    Subnet
                     192.168.0.11 192.168.0.1 255.255.255.0 */
      };

   
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
３．評価ボードの設定
───────────────────────────────────────
■接続
　評価ボードCON3とPCをクロスケーブルで接続します。
         
  ホストPCのターミナルソフトの設定は、次のようにします。
  ┌───────────────────────┐
  │Baud rate  Data  Parity  Stop  Flow control   │
  │---------  ----  ------  ----  ------------   │
  │ 115200    8bit   none   1bit   NONE          │
  └───────────────────────┘



━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
４．ロードモジュールのビルド
───────────────────────────────────────
　IAR Embedded Workbenchによりロードモジュールを生成します。

①ワークスペースを開く
　EWARM起動後、本サンプルプログラム内 Armadillo-440.ewwを起動してください。

②プロジェクトを選択する
　ワークスペースには、デバッグ用に２つのプロジェクトが作成されています。Thumbス
テートを使用した"ThumbLittle"とARMステートのみの"ARMLittle"です。各のプロジェ
クトには"Debug"と"Flash"の2つのコンフィグレーションがあります。
　ワークスペースウィンドウでプロジェクト名が太字で強調されている方がアクティブ
で、使用したいプロジェクトがアクティブになっていない場合はアクティブにします。

③ビルド
　"メイク"ボタンをクリックするとコンパイル／リンクが行われ、プロジェクト名のフォ
ルダに、ロードモジュールのプロジェクト名.outが生成されます。


━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
５．ダウンロードと実行
───────────────────────────────────────

５．１．J-Linkによるダウンロードと実行

①JTAGエミュレータの接続
　ターゲットボードにJ-LinkのJTAGコネクタを接続し、ターゲットボードの電源をONにし
ます。

②プログラムの実行
　"Debug"コンフィグレーションを選択した状態で"ダウンロードしてデバッグ"ボタンを
クリックすると、生成されたロードモジュールがSDRAMにダウンロードされ、main()ま
で実行されて一旦止まります。"実行"ボタンを押すとプログラムは続行します。

③Flashメモリへのダウンロード
　J-Linkを外してプログラムを実行させるには、予めFlashメモリへロードモジュールを
書き込みます。"Flash"コンフィグレーションを選択した状態で"ダウンロードしてデ
バッグ"ボタンをクリックすると、Flashメモリへの書き込みが行われます。


５．２．PALMiCE3によるダウンロードと実行

②JTAGエミュレータの接続
　ターゲットボードにPALMiCE3のJTAGコネクタを接続し、PALMiCE3とターゲットボード
の電源を順番にONにします。

②デバッガの起動とダウンロード
　csideP3.cpfをダブルクリックし、デバッガ CSIDE for PALMiCE3 ARMを起動します。
初期化後、登録されたロードモジュールがSDRAMにダウンロードされます。デフォルト
はプロジェクト"ARMLittle"となっているため、プロジェクト"ThumbLittle"をデバッ
グする場合には、"ファイルロード"をクリックし"ThumbLittle.out"側を選択します。

③プログラムの実行
　"プログラム実行"ボタンをクリックし、ダウンロードされたプログラムを実行します。

④ROMでの実行
　PALMiCE3を外してプログラムを実行させるには、Flashメモリにロードモジュールを
書き込みます。尚、オフセットアドレスとして0x20000000を指定しダウンロードする
ことにより、Flashへの書き込みが行われます。


━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
６．更新履歴
───────────────────────────────────────
Version Information
    2010.12.17: Created
    2011.07.13: IAR Embedded Workbench V6.20に対応
                FTP, ping, DNSのサンプル収録
    2015.08.20: IAR Embedded Workbench V7.10.3に対応
                TCPプロトコルスタックv3に合わせてサンプルプログラムを再構築しました。
                